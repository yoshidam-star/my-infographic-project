<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>付属図書館 利用状況アンケート インフォグラフィック</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* 埋め込み環境向けに高さを少し大きく設定 */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 350px; /* 300pxから350pxに変更 */
            max-height: 450px; /* 400pxから450pxに変更 */
        }
        .chart-container.h-lg {
            height: 450px; /* 400pxから450pxに変更 */
            max-height: 550px; /* 500pxから550pxに変更 */
        }
        .chart-container.h-sm {
            height: 250px;
            max-height: 250px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
            .chart-container.h-lg {
                height: 450px;
            }
        }
        /* Googleサイトの埋め込みで、スクロールバーを非表示にするため */
        html, body {
             overflow: hidden; 
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'lib-primary': '#0A2463',
                        'lib-secondary': '#3E92CC',
                        'lib-accent': '#FF4040',
                        'lib-light-bg': '#D8F3FF',
                        'lib-bg': '#FBFEF9',
                        'lib-text': '#0A2463',
                    }
                }
            }
        }
    </script>
</head>

<div class="bg-lib-light-bg text-lib-text font-sans">
    <header class="bg-lib-primary text-white p-6 shadow-md sticky top-0 z-10 pt-12 md:pt-6">
        <h1 class="text-2xl md:text-3xl font-bold text-center">令和7年度 付属図書館 利用状況アンケート</h1>
    </header>

    <main class="container mx-auto p-4 md:p-8">

        <div class="bg-white rounded-lg shadow-md p-6 md:p-8 mb-8">
            <h2 class="text-2xl font-bold text-lib-primary mb-4">アンケート概要と主な所見</h2>
            <p class="text-gray-700 mb-4">
                本アンケートは、看護大（回答262名、回収率78.9%）および短大（回答264名、回収率64.4%）の学生を対象に実施されました。
                短大の回収率は全体で64.4%でしたが、「生活学科住居・デザイン専攻」(15.3%) および「幼児教育保育学科」(41.8%) の回収率が著しく低く、特に住居・デザイン専攻の回答は9名のみであったため、短大全体の集計結果の解釈には注意が必要です。
            </p>
            <p class="text-gray-700">
                全体として、利用は「試験・課題時」に集中する傾向、看護大での専門DBの高い利用率、短大でのDBの低い認知度、ブックリスト認知度の看護大での低下、および夜間開館の「希望」と「実態」のギャップが明確になりました。
            </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

            <div class="md:col-span-2 bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-bold text-lib-primary mb-4">セクション1：基本利用状況</h2>
                <p class="text-gray-700 mb-6">
                    過去1年間の図書館利用経験では、看護大の非利用者が約11%であるのに対し、短大では約29%と高い傾向にありました。利用頻度については、両者とも「試験や課題、実習がある時だけ」というライトユーザー層が最も多いことが共通しています。
                </p>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-xl font-bold text-center mb-4">看護大：図書館利用経験 (N=262)</h3>
                <p class="text-sm text-center text-gray-600 mb-4">非利用者は約1割に留まっています。</p>
                <div class="chart-container h-sm">
                    <canvas id="nonUseChartNurse"></canvas>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-xl font-bold text-center mb-4">短大：図書館利用経験 (N=264)</h3>
                <p class="text-sm text-center text-gray-600 mb-4">非利用者が約3割を占めています。</p>
                <div class="chart-container h-sm">
                    <canvas id="nonUseChartJC"></canvas>
                </div>
            </div>

            <div class="md:col-span-2 bg-white rounded-lg shadow-md p-6">
                <h3 class="text-xl font-bold text-center mb-4">利用頻度の比較（利用経験者対象）</h3>
                <p class="text-sm text-center text-gray-600 mb-4">両大学とも「試験・課題時のみ」の利用が最多ですが、短大は看護大に比べてライトユーザー層（月/年数回）の割合がやや高い傾向が見られます。</p>
                <div class="chart-container h-lg">
                    <canvas id="freqChart"></canvas>
                </div>
            </div>

            <div class="md:col-span-2 bg-white rounded-lg shadow-md p-6 mt-6">
                <h2 class="text-2xl font-bold text-lib-primary mb-4">セクション2：利用目的</h2>
                <p class="text-gray-700 mb-6">
                    利用目的は、看護大と短大で明確な違いが出ました。看護大は実習や試験勉強といった専門学習の目的が上位を占める一方、短大では「空き時間を過ごす」が3位に入っており、学習の場であると同時に居場所としても機能していることがうかがえます。
                </p>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-xl font-bold text-center mb-4">看護大の利用目的 トップ5 (N=233)</h3>
                <div class="chart-container">
                    <canvas id="purposeChartNurse"></canvas>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-xl font-bold text-center mb-4">短大の利用目的 トップ5 (N=187)</h3>
                <div class="chart-container">
                    <canvas id="purposeChartJC"></canvas>
                </div>
            </div>

            <div class="md:col-span-2 bg-white rounded-lg shadow-md p-6 mt-6">
                <h2 class="text-2xl font-bold text-lib-primary mb-4">セクション3：契約データベース</h2>
                <p class="text-gray-700 mb-6">
                    データベースの利用状況は、両大学で最も大きな差が出た項目です。看護大では専門DBの認知・利用が進んでいますが、検索方法やアクセスに関する課題も見られます。一方、短大では利用経験が6.4%と極めて低く、「存在を知らない」「使う必要がない」が非利用の理由として大多数を占めました。
                </p>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-xl font-bold text-center mb-4">看護大：DB認知度 (N=262)</h3>
                <p class="text-sm text-center text-gray-600 mb-4">専門DBの認知度は高い水準にあります。</p>
                <div class="chart-container">
                    <canvas id="dbAwarenessChart"></canvas>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-xl font-bold text-center mb-4">看護大：DB利用時の問題 (N=128)</h3>
                <p class="text-sm text-center text-gray-600 mb-4">検索や学外アクセス、同時接続数超過が課題です。</p>
                <div class="chart-container">
                    <canvas id="dbProblemChart"></canvas>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-xl font-bold text-center mb-4">短大：DB利用経験 (N=264)</h3>
                <p class="text-sm text-center text-gray-600 mb-4">利用経験者はわずか6.4%に留まります。</p>
                <div class="chart-container h-sm">
                    <canvas id="dbUsageJCChart"></canvas>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-xl font-bold text-center mb-4">短大：DBを利用しない理由 (N=247)</h3>
                <p class="text-sm text-center text-gray-600 mb-4">「知らない」「必要ない」が8割を超えました。</p>
                <div class="chart-container">
                    <canvas id="dbNonUseJCChart"></canvas>
                </div>
            </div>

            <div class="md:col-span-2 bg-white rounded-lg shadow-md p-6 mt-6">
                <h2 class="text-2xl font-bold text-lib-primary mb-4">セクション4：ブックリストと利用者メニュー</h2>
                <p class="text-gray-700 mb-6">
                    「利用者メニュー」の利用率は看護大・短大ともに約7%と低迷しています。ブックリストの認知度は、看護大で昨年度から7.9ポイント低下し、短大では学科による認知度の差が非常に大きいという課題が明らかになりました。
                </p>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-xl font-bold text-center mb-4">利用者メニュー利用率（両大学合計 N=526）</h3>
                <div class="chart-container h-sm">
                    <canvas id="userMenuChart"></canvas>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-xl font-bold text-center mb-4">看護大：ブックリスト認知度の経年変化</h3>
                <p class="text-sm text-center text-gray-600 mb-4">R6年度から認知率が低下しています。</p>
                <div class="chart-container">
                    <canvas id="bookListNurseChart"></canvas>
                </div>
            </div>

            <div class="md:col-span-2 bg-white rounded-lg shadow-md p-6">
                <h3 class="text-xl font-bold text-center mb-4">短大：ブックリスト認知度（学科別 R7）</h3>
                <p class="text-sm text-center text-gray-600 mb-4">学科により最大6倍近い認知度の差がありました。</p>
                <div class="chart-container h-lg">
                    <canvas id="bookListJCChart"></canvas>
                </div>
            </div>

            <div class="md:col-span-2 bg-white rounded-lg shadow-md p-6 mt-6">
                <h2 class="text-2xl font-bold text-lib-primary mb-4">セクション5：別館 夜間開館の希望と実態</h2>
                <p class="text-gray-700 mb-6">
                    別館の夜間開館について、看護大では6割以上が「必要」と回答しましたが、実際の利用者は約2割でした。短大では「必要」が約37%に対し、利用者はわずか1.9%でした。両大学とも「潜在的な希望」と「実際の利用」に大きなギャップがあり、ニーズが試験・実習期間などの多忙な時期に集中していることが示唆されます。
                </p>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-xl font-bold text-center mb-4">看護大：夜間開館の希望と実態</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <h4 class="text-lg font-semibold text-center text-lib-secondary">希望 (N=262)</h4>
                        <div class="chart-container h-sm">
                            <canvas id="nightNeedNurse"></canvas>
                        </div>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold text-center text-lib-secondary">利用実績 (N=262)</h4>
                        <div class="chart-container h-sm">
                            <canvas id="nightUseNurse"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-xl font-bold text-center mb-4">短大：夜間開館の希望と実態</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <h4 class="text-lg font-semibold text-center text-lib-secondary">希望 (N=264)</h4>
                        <div class="chart-container h-sm">
                            <canvas id="nightNeedJC"></canvas>
                        </div>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold text-center text-lib-secondary">利用実績 (N=264)</h4>
                        <div class="chart-container h-sm">
                            <canvas id="nightUseJC"></canvas>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <footer class="text-center p-6 text-gray-600 text-sm mt-8">
        令和7年度 付属図書館 利用状況アンケート | このインフォグラフィックはレポートデータを基に生成されました。
    </footer>

    <script>
        // グラフ描画関数を定義
        const drawCharts = () => {
            
            // Chart.jsがロードされているか確認 (万が一のため)
            if (typeof Chart === 'undefined') {
                const containers = document.getElementsByClassName('chart-container');
                for (let i = 0; i < containers.length; i++) {
                    // エラーメッセージを表示して、グラフの代わりにテキストを表示
                    containers[i].innerHTML = '<div style="display:flex; align-items:center; justify-content:center; height:100%; background-color:#F3F4F6; border-radius:8px;"><p style="color:#DC2626; padding:16px; text-align:center;">グラフの読み込みに失敗しました。<br>インターネット接続を確認し、ページを再読み込みしてください。</p></div>';
                }
                return; // 処理を停止
            }

            // グラフの色定義
            const chartColors = {
                primary: '#3E92CC',
                secondary: '#0A2463',
                accent: '#FF4040',
                gray: '#9CA3AF',
                light: '#D8F3FF'
            };

            // ツールチップのコールバック関数
            const multiLineTooltipTitle = (tooltipItems) => {
                const item = tooltipItems[0];
                if (!item) return '';
                let label = item.chart.data.labels[item.dataIndex];
                if (Array.isArray(label)) {
                    return label.join(' ');
                }
                return label;
            };
            
            // デフォルトのツールチッププラグイン設定
            const defaultTooltipOptions = {
                plugins: {
                    tooltip: {
                        callbacks: {
                            title: multiLineTooltipTitle
                        }
                    }
                },
                maintainAspectRatio: false,
                responsive: true
            };

            // ドーナツグラフのデフォルトオプション
            const defaultDoughnutOptions = {
                ...defaultTooltipOptions,
                plugins: {
                    ...defaultTooltipOptions.plugins,
                    legend: {
                        position: 'top', 
                    },
                },
                cutout: '60%'
            };

            // バーグラフのデフォルトオプション
            const defaultBarOptions = (indexAxis = 'x', suggestMax = null) => ({
                ...defaultTooltipOptions,
                indexAxis: indexAxis,
                scales: {
                    [indexAxis === 'x' ? 'y' : 'x']: {
                        beginAtZero: true,
                        suggestedMax: suggestMax
                    }
                }
            });


            // --- グラフ 1 ---
            new Chart(document.getElementById('nonUseChartNurse'), {
                type: 'doughnut',
                data: {
                    labels: ['利用した (88.9%)', '利用していない (11.1%)'],
                    datasets: [{
                        data: [233, 29],
                        backgroundColor: [chartColors.primary, chartColors.gray]
                    }]
                },
                options: defaultDoughnutOptions
            });

            // --- グラフ 2 ---
            new Chart(document.getElementById('nonUseChartJC'), {
                type: 'doughnut',
                data: {
                    labels: ['利用した (70.8%)', '利用していない (29.2%)'],
                    datasets: [{
                        data: [187, 77],
                        backgroundColor: [chartColors.primary, chartColors.gray]
                    }]
                },
                options: defaultDoughnutOptions
            });

            // --- グラフ 3 ---
            new Chart(document.getElementById('freqChart'), {
                type: 'bar',
                data: {
                    labels: ['ヘビーユーザー (週数回以上)', ['ライトユーザー', ' (月/年数回)'], ['試験・課題時', 'のみ']],
                    datasets: [
                        {
                            label: '看護大 (N=233)',
                            data: [22, 74, 137],
                            backgroundColor: chartColors.secondary
                        },
                        {
                            label: '短大 (N=187)',
                            data: [20, 82, 85],
                            backgroundColor: chartColors.primary
                        }
                    ]
                },
                options: defaultBarOptions('x', null)
            });

            // --- グラフ 4 ---
            new Chart(document.getElementById('purposeChartNurse'), {
                type: 'bar',
                data: {
                    labels: [['実習前・実習中の', '調べ物、準備'], '資料の貸出・返却', '試験勉強', [['課題（特別研究の', 'ための調べ物含む）'], '館内で資料を見る'],
                    datasets: [{
                        label: '人数',
                        data: [100, 99, 96, 72, 65],
                        backgroundColor: chartColors.primary
                    }]
                },
                options: defaultBarOptions('y', 110)
            });
            
            // --- グラフ 5 ---
            new Chart(document.getElementById('purposeChartJC'), {
                type: 'bar',
                data: {
                    labels: [['課題（特別研究の', 'ための調べ物含む）'], '資料の貸出・返却', '空き時間を過ごす', '授業・ゼミ', [['実習前・実習中の', '調べ物、準備']]],
                    datasets: [{
                        label: '人数',
                        data: [73, 63, 61, 56, 47],
                        backgroundColor: chartColors.primary
                    }]
                },
                options: defaultBarOptions('y', 80)
            });

            // --- グラフ 6 ---
            new Chart(document.getElementById('dbAwarenessChart'), {
                type: 'bar',
                data: {
                    labels: ['医中誌Web', 'メディカルオンライン', 'CINAHL', ['Maruzen eBook', ' Library']],
                    datasets: [{
                        label: '認知人数 (N=262)',
                        data: [151, 121, 46, 38],
                        backgroundColor: [chartColors.secondary, chartColors.secondary, chartColors.primary, chartColors.primary]
                    }]
                },
                options: defaultBarOptions('x', 160)
            });

            // --- グラフ 7 ---
            new Chart(document.getElementById('dbProblemChart'), {
                type: 'bar',
                data: {
                    labels: [['検索が', 'うまくいかなかった'], ['学外から本文が', '読めなかった'], ['同時アクセス数超過で', '本文が読めなかった'], ['使い方（操作方法）', 'が分からなかった']],
                    datasets: [{
                        label: '人数',
                        data: [21, 20, 20, 16],
                        backgroundColor: chartColors.accent
                    }]
                },
                options: defaultBarOptions('y', 25)
            });
            
            // --- グラフ 8 ---
            new Chart(document.getElementById('dbUsageJCChart'), {
                type: 'doughnut',
                data: {
                    labels: ['利用した (6.4%)', '利用なし (93.6%)'],
                    datasets: [{
                        data: [17, 247],
                        backgroundColor: [chartColors.primary, chartColors.gray]
                    }]
                },
                options: defaultDoughnutOptions
            });
            
            // --- グラフ 9 ---
            new Chart(document.getElementById('dbNonUseJCChart'), {
                type: 'bar',
                data: {
                    labels: [['サービスの', '存在を知らなかった'], ['使う必要が', 'なかった'], ['使い方が', '分からない']],
                    datasets: [{
                        label: '人数 (N=247)',
                        data: [117, 103, 27],
                        backgroundColor: chartColors.gray
                    }]
                },
                options: defaultBarOptions('y', 120)
            });
            
            // --- グラフ 10 ---
            new Chart(document.getElementById('userMenuChart'), {
                type: 'doughnut',
                data: {
                    labels: ['利用 (6.8%)', '利用なし (93.2%)'],
                    datasets: [{
                        data: [36, 490],
                        backgroundColor: [chartColors.primary, chartColors.gray]
                    }]
                },
                options: defaultDoughnutOptions
            });

            // --- グラフ 11 ---
            new Chart(document.getElementById('bookListNurseChart'), {
                type: 'bar',
                data: {
                    labels: ['R6年度 (N=260)', 'R7年度 (N=262)'],
                    datasets: [{
                        label: '認知率 (%)',
                        data: [36.5, 28.6],
                        backgroundColor: [chartColors.gray, chartColors.accent]
                    }]
                },
                options: defaultBarOptions('x', 40)
            });
            
            // --- グラフ 12 ---
            new Chart(document.getElementById('bookListJCChart'), {
                type: 'bar',
                data: {
                    labels: ['国際・地コミ', '専攻科', '食物栄養', '幼児教育保育', '情報・経営', '住居・デザイン'],
                    datasets: [{
                        label: '認知率 (%)',
                        data: [67.6, 66.7, 47.5, 39.2, 17.6, 11.1],
                        backgroundColor: [chartColors.primary, chartColors.primary, chartColors.secondary, chartColors.secondary, chartColors.accent, chartColors.accent]
                    }]
                },
                options: defaultBarOptions('x', 70)
            });
            
            // --- グラフ 13 ---
            new Chart(document.getElementById('nightNeedNurse'), {
                type: 'doughnut',
                data: {
                    labels: ['必要 (61.1%)', '不要 (38.9%)'],
                    datasets: [{
                        data: [160, 102],
                        backgroundColor: [chartColors.primary, chartColors.gray]
                    }]
                },
                options: defaultDoughnutOptions
            });

            // --- グラフ 14 ---
            new Chart(document.getElementById('nightUseNurse'), {
                type: 'doughnut',
                data: {
                    labels: ['利用した (20.6%)', '利用なし (79.4%)'],
                    datasets: [{
                        data: [54, 208],
                        backgroundColor: [chartColors.primary, chartColors.gray]
                    }]
                },
                options: defaultDoughnutOptions
            });
            
            // --- グラフ 15 ---
            new Chart(document.getElementById('nightNeedJC'), {
                type: 'doughnut',
                data: {
                    labels: ['必要 (36.7%)', '不要 (63.3%)'],
                    datasets: [{
                        data: [97, 167],
                        backgroundColor: [chartColors.primary, chartColors.gray]
                    }]
                },
                options: defaultDoughnutOptions
            });
            
            // --- グラフ 16 ---
            new Chart(document.getElementById('nightUseJC'), {
                type: 'doughnut',
                data: {
                    labels: ['利用した (1.9%)', '利用なし (98.1%)'],
                    datasets: [{
                        data: [5, 259],
                        backgroundColor: [chartColors.primary, chartColors.gray]
                    }]
                },
                options: defaultDoughnutOptions
            });

        }; // drawCharts 終了

        // ページ全体が読み込まれるのを待たずに、Chart.jsとTailwind CSSの読み込み後に実行を試みる
        // 遅延を設けて強制的に実行
        setTimeout(drawCharts, 500); // 500ミリ秒の遅延後に描画を試みる
    </script>
</div>
